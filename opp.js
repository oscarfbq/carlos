// =================================================================

// (NUEVO) MINI BASE DE DATOS DE PRODUCTOS

// =================================================================

// ¬°AQU√ç ES DONDE A√ëADIR√ÅS TODOS TUS PRODUCTOS!

// Solo copia y pega un bloque { ... }, y cambia los datos.

// Aseg√∫rate de poner la URL correcta de tu imagen.

// =================================================================

const baseDeDatos = {

    fruteria: [

        { 

            nombre: 'Aguacate', 

            precio: 59.00, 

            img: 'frutas/aguacate.jpg' 

        },

        { 

            nombre: 'Albahaca', 

            precio: 49.00, 

            img: 'frutas/albhaca.jpg' 

        },

        { 

            nombre: 'Apio', 

            precio: 39.50, 

            img: 'frutas/apio.jpg' 

        },

        { 

            nombre: 'Ajo', 

            precio: 149.00, 

            img: 'frutas/ajo.jpg' 

        },

        { 

            nombre: 'Brocoli', 

            precio: 36.00, 

            img: 'frutas/brocoli.jpg' 

        },



         { 

            nombre: 'Calabaza italiana', 

            precio: 18.00, 

            img: 'frutas/calabazaitaliana.jpg' 

        },

        { 

            nombre: 'cebolla.jpg', 

            precio: 17.00, 

            img: 'frutas/cebolla.jpg' 

        },

        { 

            nombre: 'Cebolla blanca grande', 

            precio: 22.50, 

            img: 'frutas/cebolla.jpg' 

        },

        { 

            nombre: 'Cebolla blanca mediana', 

            precio: 27.00, 

            img: 'frutas/cebolla.jpg' 

        },

        { 

            nombre: 'Cebolla cambray', 

            precio: 35.00, 

            img: 'frutas/cebollacambray.jpg' 

        },

        { 

            nombre: 'Cebolla morada', 

            precio: 25.00, 

            img: 'frutas/cebollamorada.jpg' 

        },

        { 

            nombre: 'Champi√±√≥n', 

            precio: 105.00, 

            img: 'frutas/champinon.jpg' 

        },

        { 

            nombre: 'Chayote', 

            precio: 25.00, 

            img: 'frutas/chayote.jpg' 

        },

        { 

            nombre: 'Chile de √°rbol', 

            precio: 129.00, 

            img: 'frutas/chiledearbol.jpg' 

        },

        { 

            nombre: 'Chile guajillo', 

            precio: 149.00, 

            img: 'frutas/chileguajillo.jpg' 

        },

        { 

            nombre: 'Chile habanero', 

            precio: 179.00, 

            img: 'frutas/habanero.jpg' 

        },

        { 

            nombre: 'Chile jalape√±o', 

            precio: 35.00, 

            img: 'frutas/chilejalapeno.jpg' 

        },

        { 

            nombre: 'Chile morita', 

            precio: 149.00, 

            img: 'frutas/chilemorita.jpg' 

        },

        { 

            nombre: 'Chile puya', 

            precio: 139.00, 

            img: 'frutas/chilepuya.jpg' 

        },

        { 

            nombre: 'Chileserrano verde', 

            precio: 45.00, 

            img: 'frutas/chileserrano.jpg' 

        },

        { 

            nombre: 'Cilantro', 

            precio: 89.00, 

            img: 'frutas/cilantro.jpg' 

        },

        { 

            nombre: 'Col blanca', 

            precio: 29.50, 

            img: 'frutas/colblanca.jpg' 

        },

        { 

            nombre: 'Col morada', 

            precio: 39.00, 

            img: 'frutas/colmorada.jpg' 

        },

        { 

            nombre: 'Coliflor', 

            precio: 39.00, 

            img: 'frutas/coliflor.jpg' 

        },

        { 

            nombre: 'Fresa', 

            precio: 79.00, 

            img: 'frutas/fresa.jpg' 

        },

        { 

            nombre: 'Hierbabuena', 

            precio: 169.00, 

            img: 'frutas/hierbabuena.jpg' 

        },

        { 

            nombre: 'J√≠cama', 

            precio: 19.50, 

            img: 'frutas/jicama' 

        },

        { 

            nombre: 'Jitomate bola', 

            precio: 37.00, 

            img: 'frutas/jitomatebola.jpg' 

        },

        { 

            nombre: 'Jitomate primera', 

            precio: 18.50, 

            img: 'frutas/jitomatepri mera.jpg' 

        },

        { 

            nombre: 'Jitomate segunda', 

            precio: 16.00, 

            img: 'frutas/jitomate segunda.jpg' 

        },

        { 

            nombre: 'Lechuga bola', 

            precio: 22.00, 

            img: 'frutas/lechugabola.jpg' 

        },

        { 

            nombre: 'Lechugas finas', 

            precio: 32.00, 

            img: 'frutas/lechuga finas.jpg' 

        },

        { 

            nombre: 'Lim√≥n agrio grande', 

            precio: 25.00, 

            img: 'frutas/limon con semilla.jpg' 

        },

        { 

            nombre: 'Lim√≥n agrio mediano', 

            precio: 21.00, 

            img: 'frutas/limonconsemilla.jpg' 

        },

        { 

            nombre: 'Lim√≥n sin semilla', 

            precio: 18.50, 

            img: 'frutas/limon sinse milla.jpg' 

     

        },

        { 

            nombre: 'Manzana golden', 

            precio: 44.80, 

            img: 'frutas/manzana goolden.jpg' 

        },

        { 

            nombre: 'Naranja amarilla', 

            precio: 39.50, 

            img: 'frutas/naranja amarilla.jpg' 

        },

        { 

            nombre: 'Naranja verde', 

            precio: 21.50, 

            img: 'frutas/naranja verde.jpg' 

        },

        { 

            nombre: 'Papa blanca', 

            precio: 19.50, 

            img: 'frutas/papablanca.jpg' 

        },

        { 

            nombre: 'Pepinillo', 

            precio: 34.50, 

            img: 'frutas/pepinillos.jpg' 

        },

        { 

            nombre: 'Pepino', 

            precio: 29.00, 

            img: 'frutas/pepino.jpg' 

        },

        { 

            nombre: 'Pera', 

            precio: 89.80, 

            img: 'frutas/pera.jpg' 

        },

        { 

            nombre: 'Pimiento morr√≥n', 

            precio: 67.00, 

            img: 'frutas/morron.jpg' 

        },

        { 

            nombre: 'Poro', 

            precio: 39.00, 

            img: 'frutas/poro.jpg' 

        },

        { 

            nombre: 'R√°banos', 

            precio: 39.00, 

            img: 'frutas/rabanos.jpg' 

        },

        { 

            nombre: 'Sand√≠a personal', 

            precio: 19.50, 

            img: 'frutas/sandiapersonal.jpg' 

        },

        { 

            nombre: 'Tomate', 

            precio: 13.00, 

            img: 'frutas/tomate.jpg' 

        },

        { 

            nombre: 'Uva verde sin semilla', 

            precio: 159.00, 

            img: 'frutas/uva verde.jpg' 

        },

        { 

            nombre: 'Zanahoria', 

            precio: 19.50, 

            img: 'frutas/zanahoria.jpg' 

        },
        
        // ... Puedes a√±adir 50 productos m√°s aqu√≠ ...
        // { 
        //     nombre: 'Manzana Gala', 
        //     precio: 40.00, 
        //     img: 'https://url-de-tu-manzana.jpg' 
        // },
    ],
    carniceria: [
        // ... Aqu√≠ ir√≠an tus productos de carnicer√≠a en el futuro ...
        { 
          nombre: 'Pechuga filetiada', 
           precio: 149.00, 
           img: '' 
         },
         { 
          nombre: 'Pierna y muslo', 
           precio: 145.00, 
           img: '' 
         },
         { 
          nombre: 'milanesa', 
           precio: 129.00, 
           img: '' 
         },
         { 
          nombre: 'bisteck picado', 
           precio: 95.00, 
           img: '' 
         },
         { 
          nombre: 'carne molida', 
           precio: 139.00, 
           img: '' 
         },
         { 
          nombre: 'pechuga', 
           precio: 149.00, 
           img: '' 
         },


    

 






    ]




    




};


// =================================================================
// (NUEVA) FUNCI√ìN PARA CARGAR PRODUCTOS EN EL HTML
// =================================================================
function cargarProductos(productos, gridElementId) {
    const grid = document.getElementById(gridElementId);
    
    // Si no encuentra el grid (ej. 'grid-carniceria' a√∫n no existe), no hace nada
    if (!grid) {
        console.warn(`No se encontr√≥ el elemento con id: ${gridElementId}`);
        return; 
    }

    grid.innerHTML = ''; // Limpiamos el grid por si acaso

    // Recorremos la lista de productos
    productos.forEach(producto => {
        
        // Creamos el HTML para la tarjeta
        // Usamos los datos del objeto: producto.img, producto.nombre, producto.precio
        const tarjetaHTML = `
            <div class="producto-card">
                <img src="${producto.img}" alt="${producto.nombre}" onerror="this.onerror=null; this.src='https://via.placeholder.com/300x200?text=Imagen+no+disponible'">
                <h3>${producto.nombre}</h3>
                <p class="precio">$${producto.precio.toFixed(2)} / kg</p>
                
                <div class="kilo-selector">
                    <button type="button" class="btn-kilo btn-menos" aria-label="Disminuir">-</button>
                    <input class="kilo-input" type="text" value="1.0" readonly>
                    <button type="button" class="btn-kilo btn-mas" aria-label="Aumentar">+</button>
                    <span class="kilo-label">kg</span>
                </div>
                
                <button class="btn-compra" data-nombre="${producto.nombre}" data-precio="${producto.precio.toFixed(2)}">
                    A√±adir a la Cesta
                </button>
            </div>
        `;
        
        // A√±adimos la tarjeta al grid
        grid.innerHTML += tarjetaHTML;
    });
}


// =================================================================
// EL RESTO DE TU C√ìDIGO (CARRITO, WHATSAPP, ETC.)
// =================================================================

document.addEventListener('DOMContentLoaded', () => {

    // --- VARIABLES IMPORTANTES ---
    
    let carrito = {};

    // ¬°¬°¬°CAMBIA ESTE N√öMERO POR EL TUYO!!! (Incluyendo el 52 si es de M√©xico)
    const TU_NUMERO_DE_WHATSAPP = "524613267745"; // Ejemplo: "5214611234567"

    // Seleccionamos los elementos del DOM
    const listaCarrito = document.getElementById('lista-carrito');
    const totalPedido = document.getElementById('total-pedido');
    const carritoContador = document.getElementById('carrito-contador');
    const btnEnviarWhatsApp = document.getElementById('enviar-whatsapp');

    // Elementos para la factura
    const checkFactura = document.getElementById('requiere-factura');
    const datosFactura = document.getElementById('datos-factura');
    const inputRFC = document.getElementById('cliente-rfc');
    const inputRazonSocial = document.getElementById('cliente-razon-social');
    const inputUsoCFDI = document.getElementById('cliente-uso-cfdi');

    
    // --- (NUEVO) LLAMADA PARA CARGAR PRODUCTOS ---
    // Le decimos que cargue la lista 'fruteria' en el grid 'grid-fruteria'
    cargarProductos(baseDeDatos.fruteria, 'grid-fruteria');
    // (En el futuro, cargar√≠as los otros departamentos)
    // cargarProductos(baseDeDatos.carniceria, 'grid-carniceria');


    // --- FUNCIONES DEL CARRITO ---

    function manejarClicFruteria(evento) {
        const target = evento.target;
        if (target.classList.contains('btn-compra')) {
            anadirAlCarrito(target); 
        }
        if (target.classList.contains('btn-kilo')) {
            gestionarKilos(target); 
        }
    }
    
    // (Aqu√≠ necesitar√°s a√±adir listeners para los otros grids en el futuro)
    // document.getElementById('grid-carniceria').addEventListener('click', manejarClicFruteria);


    function gestionarKilos(boton) {
        const card = boton.closest('.producto-card');
        const input = card.querySelector('.kilo-input');
        let valor = parseFloat(input.value);

        if (boton.classList.contains('btn-mas')) {
            valor += 0.5;
        } else if (boton.classList.contains('btn-menos')) {
            valor -= 0.5;
        }

        if (valor < 0.5) {
            valor = 0.5;
        }
        input.value = valor.toFixed(1);
    }

    function anadirAlCarrito(boton) {
        const card = boton.closest('.producto-card');
        const nombre = boton.dataset.nombre;
        const precio = parseFloat(boton.dataset.precio);
        const kilos = parseFloat(card.querySelector('.kilo-input').value);

        if (kilos > 0) {
            if (carrito[nombre]) {
                carrito[nombre].kilos += kilos;
            } else {
                carrito[nombre] = {
                    precio: precio,
                    kilos: kilos
                };
            }
            actualizarCarritoUI();
        } else {
            alert("Por favor, selecciona una cantidad mayor a 0.");
        }
    }

    function actualizarCarritoUI() {
        listaCarrito.innerHTML = '';
        let total = 0;
        let numItems = 0;

        for (const nombre in carrito) {
            const item = carrito[nombre];
            const subtotal = item.precio * item.kilos;
            total += subtotal;
            numItems++; 

            const li = document.createElement('li');
            li.innerHTML = `
                <span>${nombre} (${item.kilos.toFixed(1)} kg) - $${subtotal.toFixed(2)}</span>
                <button class="btn-eliminar" data-nombre="${nombre}">√ó</button>
            `;
            listaCarrito.appendChild(li);
        }
        totalPedido.textContent = `Total: $${total.toFixed(2)}`;
        carritoContador.textContent = numItems;
    }

    function eliminarDelCarrito(evento) {
        if (evento.target.classList.contains('btn-eliminar')) {
            const nombre = evento.target.dataset.nombre;
            delete carrito[nombre];
            actualizarCarritoUI();
        }
    }

    function enviarPedidoWhatsApp() {
        const nombreCliente = document.getElementById('cliente-nombre').value;
        const telefonoCliente = document.getElementById('cliente-telefono').value;
        const direccionCliente = document.getElementById('cliente-direccion').value;

        if (!nombreCliente || !telefonoCliente || !direccionCliente) {
            alert("Por favor, completa tu Nombre, Tel√©fono y Direcci√≥n.");
            return;
        }

        let mensaje = `¬°Hola D'LCAMPO! üëã Quiero hacer un pedido:\n\n`;
        mensaje += `*Cliente:* ${nombreCliente}\n`;
        mensaje += `*Tel√©fono:* ${telefonoCliente}\n`;
        mensaje += `*Direcci√≥n:* ${direccionCliente}\n\n`;

        if (checkFactura.checked) {
            const rfc = inputRFC.value;
            const razonSocial = inputRazonSocial.value;
            const usoCFDI = inputUsoCFDI.value;

            if (!rfc || !razonSocial || !usoCFDI) {
                alert("Por favor, completa todos tus datos de facturaci√≥n (RFC, Raz√≥n Social y Uso de CFDI).");
                return;
            }
            
            mensaje += `*--- DATOS DE FACTURACI√ìN ---*\n`;
            mensaje += `*RFC:* ${rfc}\n`;
            mensaje += `*Raz√≥n Social:* ${razonSocial}\n`;
            mensaje += `*Uso de CFDI:* ${usoCFDI}\n\n`;
        }

        mensaje += `*MI PEDIDO:*\n`;
        let total = 0;
        
        if (Object.keys(carrito).length === 0) {
            alert("Tu carrito est√° vac√≠o. A√±ade productos antes de enviar.");
            return;
        }

        for (const nombre in carrito) {
            const item = carrito[nombre];
            const subtotal = item.precio * item.kilos;
            total += subtotal;
            mensaje += `- ${nombre} (${item.kilos.toFixed(1)} kg) - $${subtotal.toFixed(2)}\n`;
        }

        mensaje += `\n*TOTAL A PAGAR: $${total.toFixed(2)}*`;

        const mensajeCodificado = encodeURIComponent(mensaje);
        const urlWhatsApp = `https://api.whatsapp.com/send?phone=${TU_NUMERO_DE_WHATSAPP}&text=${mensajeCodificado}`;

        window.open(urlWhatsApp, '_blank');
    }

    function toggleCamposFactura() {
        if (checkFactura.checked) {
            datosFactura.style.display = 'block'; 
            inputRFC.required = true;
            inputRazonSocial.required = true;
            inputUsoCFDI.required = true;
        } else {
            datosFactura.style.display = 'none'; 
            inputRFC.required = false;
            inputRazonSocial.required = false;
            inputUsoCFDI.required = false;
        }
    }

    // --- EVENT LISTENERS (Aqu√≠ conectamos todo) ---

    // 1. Escuchar clics en la secci√≥n de fruter√≠a (para +,- y A√±adir)
    // (Usamos el 'id' del grid que pusimos en el HTML)
    document.getElementById('grid-fruteria').addEventListener('click', manejarClicFruteria);

    // 2. Escuchar clics en la lista del carrito para "Eliminar"
    listaCarrito.addEventListener('click', eliminarDelCarrito);

    // 3. Escuchar clic en el bot√≥n de "Enviar Pedido"
    btnEnviarWhatsApp.addEventListener('click', enviarPedidoWhatsApp);
    
    // 4. Escuchar cambios en el checkbox de factura
    checkFactura.addEventListener('change', toggleCamposFactura);

});



